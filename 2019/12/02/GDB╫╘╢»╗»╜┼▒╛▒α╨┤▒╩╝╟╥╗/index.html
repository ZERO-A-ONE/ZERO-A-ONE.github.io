<!DOCTYPE html>





<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">
  <link rel="alternate" href="/atom.xml" title="ZERO-A-ONE" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Kopieren',
      copy_success: 'Kopiert',
      copy_failure: 'Kopieren fehlgeschlagen'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="作为UNIX/Linux下使用广泛的调试器，gdb不仅提供了丰富的命令，还引入了对脚本的支持：一种是对已存在的脚本语言支持，比如python，用户可以直接书写python脚本，由gdb调用python解释器执行；另一种是命令脚本，用户可以在脚本中书写gdb已经提供的或者自定义的gdb命令，再由gdb执行 我们通常都是在交互模式下使用 GDB 的，即手动输入各种 GDB 命令。其实 GDB 也支持执">
<meta property="og:type" content="article">
<meta property="og:title" content="GDB自动化脚本编写笔记一">
<meta property="og:url" content="http://yoursite.com/2019/12/02/GDB╫╘╢»╗»╜┼▒╛▒α╨┤▒╩╝╟╥╗/index.html">
<meta property="og:site_name" content="ZERO-A-ONE">
<meta property="og:description" content="作为UNIX/Linux下使用广泛的调试器，gdb不仅提供了丰富的命令，还引入了对脚本的支持：一种是对已存在的脚本语言支持，比如python，用户可以直接书写python脚本，由gdb调用python解释器执行；另一种是命令脚本，用户可以在脚本中书写gdb已经提供的或者自定义的gdb命令，再由gdb执行 我们通常都是在交互模式下使用 GDB 的，即手动输入各种 GDB 命令。其实 GDB 也支持执">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-03T04:22:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GDB自动化脚本编写笔记一">
<meta name="twitter:description" content="作为UNIX/Linux下使用广泛的调试器，gdb不仅提供了丰富的命令，还引入了对脚本的支持：一种是对已存在的脚本语言支持，比如python，用户可以直接书写python脚本，由gdb调用python解释器执行；另一种是命令脚本，用户可以在脚本中书写gdb已经提供的或者自定义的gdb命令，再由gdb执行 我们通常都是在交互模式下使用 GDB 的，即手动输入各种 GDB 命令。其实 GDB 也支持执">
  <link rel="canonical" href="http://yoursite.com/2019/12/02/GDB╫╘╢»╗»╜┼▒╛▒α╨┤▒╩╝╟╥╗/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>GDB自动化脚本编写笔记一 | ZERO-A-ONE</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZERO-A-ONE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Navigationsleiste an/ausschalten">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Startseite</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archiv</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Suche</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Suche..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
     <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/02/GDB╫╘╢»╗»╜┼▒╛▒α╨┤▒╩╝╟╥╗/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZERO-A-ONE">
      <meta itemprop="description" content="Resit much,Obey little">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZERO-A-ONE">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">GDB自动化脚本编写笔记一

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>

              
                
              

              <time title="Erstellt: 2019-12-02 04:21:51 / Geändert am: 20:22:04" itemprop="dateCreated datePublished" datetime="2019-12-02T04:21:51-08:00">2019-12-02</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>作为UNIX/Linux下使用广泛的调试器，gdb不仅提供了丰富的命令，还引入了对脚本的支持：一种是对已存在的脚本语言支持，比如python，用户可以直接书写python脚本，由gdb调用python解释器执行；另一种是命令脚本，用户可以在脚本中书写gdb已经提供的或者自定义的gdb命令，再由gdb执行</p>
<p>我们通常都是在交互模式下使用 GDB 的，即手动输入各种 GDB 命令。其实 GDB 也支持执行预先写好的调试脚本，进行自动化的调试。调试脚本由一系列的 GDB 命令组成，GDB 会顺序执行调试脚本中的命令</p>
<h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>下面是一个带bug的二分查找实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binary_search</span><span class="params">(<span class="keyword">int</span> *ary, <span class="keyword">unsigned</span> <span class="keyword">int</span> ceiling, <span class="keyword">int</span> target)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">floor</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ceiling &gt; <span class="built_in">floor</span>) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> pivot = (ceiling + <span class="built_in">floor</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (ary[pivot] &lt; target)</span><br><span class="line">            <span class="built_in">floor</span> = pivot + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ary[pivot] &gt; target)</span><br><span class="line">            ceiling = pivot - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> pivot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; binary_search(a, <span class="number">5</span>, <span class="number">7</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// -1</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; binary_search(a, <span class="number">5</span>, <span class="number">6</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 4</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; binary_search(a, <span class="number">5</span>, <span class="number">5</span>) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 期望3，实际运行结果是-1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你打算调试下<code>binary_search(a, 5, 5)</code>这个组合。若如果用print大法，就在<code>binary_search</code>中插入几个print，运行后扫一眼，看看<code>target=5</code>的时候运行流是怎样的</p>
<p>debugger大法看似会复杂一点，如果在<code>binary_search</code>中插断点，那么前两次调用只能连按<code>c</code>跳过。其实没那么复杂，gdb允许用户设置条件断点。你可以这么设置：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b binary_search <span class="keyword">if</span> target == <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>现在就只有第三次调用会触发断点</p>
<p>问题看上去跟<code>floor</code>和<code>ceiling</code>值的变化有关。要想观察它们的值，可以<code>p floor</code>和<code>p ceiling</code>。不过有个简单的方法，你可以对它们设置watch断点：<code>wa floor if target == 5</code>。当<code>floor</code>的值变化时，就会触发断点</p>
<p>对于我们的示例程序来说，靠脑补也能算出这两个值的变化，专门设置断点似乎小题大做。不过在调试真正的程序时，watch断点非常实用，尤其当你对相关代码不熟悉时。使用watch断点可以更好地帮助你理解程序流程，有时甚至会有意外惊喜。另外结合debugger运行时修改值的能力，你可以在值变化的下一刻设置目标值，观察走不同路径会不会出现类似的问题。如果有需要的话，还可以给某个内存地址设断点：<code>wa *0x7fffffffda40</code></p>
<p>除了watch之外，gdb还有一类catch断点，可以用来捕获异常/系统调用/信号。因为用途不大（我从没实际用过），就不介绍了，感兴趣的话在gdb里面<code>help catch</code>看看</p>
<h2 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h2><p>编写调试脚本时必须要处理好断点的问题。在交互模式下，程序执行至脚本时，GDB 会等待用户输入下一步的命令。如何在脚本中定义断点触发时进行的操作？这需要一种类似回调函数的机制</p>
<p>GDB 中使用 <strong>Breakpoint Command Lists</strong> 的机制来实现这一点，可以给某个断点挂上待触发的命令。用户可以定义，当程序停在某个 breakpoint (或 watchpoint, catchpoint) 时，执行由 <code>command-list</code> 定义的一系列命令。其语法为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands [<span class="built_in">list</span>…]</span><br><span class="line">… command-<span class="built_in">list</span> …</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>例如，我想在每次进入 <code>foo</code> 函数且其参数 <code>x</code> &gt; 0 时打印 <code>x</code> 的值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span> foo <span class="keyword">if</span> x&gt;<span class="number">0</span></span><br><span class="line">commands</span><br><span class="line">silent</span><br><span class="line"><span class="built_in">printf</span> <span class="string">"x is %d\n"</span>,x</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>这里有几点要注意的：</p>
<ul>
<li>Breakpoint command list 中的第一个命令通常是 <code>silent</code>。这会让断点触发是打印的消息尽量精简。如果 <code>command … end</code> 中没有 <code>printf</code> 之类的打印语句，断点触发时甚至不会产生任何输出</li>
<li>Breakpoint command list 中的最后一个命令通常是 <code>continue</code>。这样程序不会在断点处停下，自动化调试脚本可以继续执行</li>
</ul>
<p>GDB 运行自动化调试脚本的方式为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb [program] -batch -x [commands_file] &gt; <span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>其中 <code>-batch</code> 参数将 GDB 运行为脚本模式（不进入交互环境），<code>-x</code> 参数 (也可以写为 <code>-command</code>) 指定调试脚本文件</p>
<h2 id="define"><a href="#define" class="headerlink" title="define"></a>define</h2><p>举个例子，继续上面的二分查找操作<code>b binary_search if target == 5</code>之后，输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">comm</span><br><span class="line">i locals</span><br><span class="line">i args</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>按照之前的格式也可以是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">b binary_search if target == 5</span><br><span class="line">commands</span><br><span class="line">silent</span><br><span class="line">i locals</span><br><span class="line">i args</span><br><span class="line">continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>这样当上面的断点被触发时，<code>i locals</code>和<code>i args</code>命令会被触发，列出当前上下文内的变量。这个功能挺废的，因为你完全可以在断点被触发后才敲入这几个命令</p>
<p>要不是有<code>define</code>，<code>commands</code>就真成摆设了。接下来我们要介绍<code>commands</code>的好基友、最强大的gdb命令之一，<code>define</code>命令</p>
<p>一如unix世界里面的许多程序一样，gdb内部实现了一门DSL（领域特定语言）。用户可以通过这门DSL来编写自定义的宏，甚至编写调试用的自动化脚本。我们可以用<code>define</code>命令编写自定义的宏</p>
<p>继续上面的例子，你可以自定义一个命令代替<code>b xxx comm ...</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) define br_info</span><br><span class="line">Type commands <span class="keyword">for</span> definition of <span class="string">"br_info"</span>.</span><br><span class="line">End with a line saying just <span class="string">"end"</span>.</span><br><span class="line">&gt;b $arg0</span><br><span class="line">&gt;comm</span><br><span class="line">&gt;i locals</span><br><span class="line">&gt;i args</span><br><span class="line">&gt;end</span><br><span class="line">(gdb) br_info binary_search <span class="keyword">if</span> target == <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>当<code>if target == 5</code>条件满足时，<code>br_info binary_search</code>会被执行。<code>br_info</code>展开成为一系列命令，并用<code>binary_search</code>替换掉<code>$arg0</code>。一行顶过去五行</p>
<p>其实<code>define</code>也就是自定义命令，格式是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define commandName  </span><br><span class="line">    statement  </span><br><span class="line">    ......  </span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>其中<code>statement</code>可以是任意gdb命令。此外自定义命令还支持最多10个输入参数：<code>$arg0</code>，<code>$arg1</code> …… <code>$arg9</code>，并且还用<code>$argc</code>来标明一共传入了多少参数</p>
<p>则上面的命令可以写为脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define br_info</span><br><span class="line">	b $arg0</span><br><span class="line">	commands</span><br><span class="line">	silent</span><br><span class="line">	i locals</span><br><span class="line">	i args</span><br><span class="line">	<span class="keyword">continue</span></span><br><span class="line">	end</span><br></pre></td></tr></table></figure>

<p>除了在会话内创建自定义宏外，我们还可以用gdb的DSL编写宏文件，并导入到gdb中</p>
<p>举个有实际意义的例子。由于源代码的改变，我们需要更新断点的位置。通常的做法是删掉原来的断点，并新设一个。让我们现学现用，用宏把这两步合成一步：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># gdb_macro</span><br><span class="line">define mv</span><br><span class="line">    <span class="keyword">if</span> $argc == <span class="number">2</span> # argc即总参数个数</span><br><span class="line">        <span class="keyword">delete</span> $arg0 # arg0即第一个参数</span><br><span class="line">        # 注意新创建的断点编号和被删除断点的编号不同</span><br><span class="line">        <span class="keyword">break</span> $arg1 # arg1即第二个参数</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        print <span class="string">"输入参数数目不对，help mv以获得用法"</span></span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># (gdb) help mv 会输出以下帮助文档</span><br><span class="line">document mv</span><br><span class="line">Move breakpoint.</span><br><span class="line">Usage: mv old_breakpoint_num new_breakpoint</span><br><span class="line">Example:</span><br><span class="line">    (gdb) mv <span class="number">1</span> binary_search -- move breakpoint <span class="number">1</span> to `b binary_search`</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"># vi:<span class="built_in">set</span> ft=gdb ts=<span class="number">4</span> sw=<span class="number">4</span> et</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b binary_search</span><br><span class="line">Breakpoint 1 at 0x40083b: file binary_search.cpp, line 7.</span><br><span class="line">(gdb) source ~/gdb_macro</span><br><span class="line">(gdb) help mv</span><br><span class="line">Move breakpoint.</span><br><span class="line">Usage: mv old_breakpoint_num new_breakpoint</span><br><span class="line">Example:</span><br><span class="line">    (gdb) mv 1 binary_search -- move breakpoint 1 to `b binary_search`</span><br><span class="line"></span><br><span class="line">(gdb) mv 1 binary_search.cpp:18</span><br><span class="line">Breakpoint 2 at 0x4008ab: file binary_search.cpp, line 18.</span><br></pre></td></tr></table></figure>

<p>在gdb中执行脚本要使用source命令，例如：“source xxx.gdb”</p>
<p>还可以进一步，把<code>source ~/gdb_macro</code>也省掉。你可以创建gdb配置文件<code>~/.gdbinit</code>，让gdb启动时自动执行里面的指令。如果把自己常用的宏写在该文件中，就能直接在gdb里面使用了，用起来如内置命令一般顺滑</p>
<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p>除此以外，还可以为自定义命令写帮助文档，也就是执行<code>help</code>命令时打印出的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">document myassign</span><br><span class="line">    assign the second parameter value to the first parameter</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="会话-历史-命令文件"><a href="#会话-历史-命令文件" class="headerlink" title="会话/历史/命令文件"></a>会话/历史/命令文件</h2><p>通常我们只有在程序出问题才会启动gdb，开始调试工作，调试完毕后退出。不过，让gdb一直开着未尝不是更好的做法。每个gdb老司机都懂得，gdb在<code>r</code>的时候会加载当前程序的最新版本。也即是说，就算不退出gdb，每次运行的也会是当前最新的版本。不退出当前调试会话有两个好处：</p>
<ol>
<li>调试上下文可以得到保留。不用每次运行都重新设一轮断点</li>
<li>一旦core dump了，可以显示core dump的位置，无需带着core重新启动一次</li>
</ol>
<p>在开发C/C++项目，我一般是这样的工作流程：一个窗口开着编辑器，编译也在这个窗口执行；另一个窗口开着gdb，这个窗口同时也用来运行程序。一旦要调试了（或者，又segment fault了），随手就可以开始干活</p>
<p>当然了，劳作一天之后，总需要关电脑回家。这时候只能退出gdb。不想明天一早再把断点设上一遍？gdb提供了保留断点的功能。输入<code>save br .gdb_bp</code>，gdb会把本次会话的断点存在<code>.gdb_bp</code>中。明天早上一回来，启动gdb的时候，加上<code>-x .gdb_bp</code>，让gdb把<code>.gdb_bp</code>当做命令文件逐条重新执行，一切又回到昨晚</p>
<h2 id="调试脚本"><a href="#调试脚本" class="headerlink" title="调试脚本"></a>调试脚本</h2><p>提到用<code>-x</code>指定命令文件来回放断点。那时的命令文件也算是一种用gdb的DSL编写的调试脚本。由于调试是件交互性的活，需要事先写好调试脚本的场景不多。即使如此，除了让gdb自动设置断点，依然有不少场景下可以用上调试脚本。其中之一，就是让gdb自动采集特定函数调用的上下文数据。我把这种方法称为“拖网法”，因为它就像拖网捕鱼一样，把逮到的东西都一股脑带上来</p>
<p>设想如下的情景：某个项目出现内存泄露的迹象。事先分配好的内存池用着用着就满了，一再地吞噬系统的内存。内存管理是自己实现的，所以无法用valgrind来分析。鉴于内存管理部分代码最近几个版本都没有改动过，猜测是业务逻辑代码里面有谁借了内存又不还。现在你需要把它揪出来。一个办法是给内存的分配和释放加上日志，再编译，然后重新运行程序，谋求复现内存泄露的场景。不过更快的办法是，敲上这一段代码：</p>
<p>（假设分配内存的接口是<code>my_malloc(char *p, size_t size)</code>，释放内存的接口是<code>free(char *p)</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># /tmp/malloc_free</span><br><span class="line"># 设置输出不要分屏</span><br><span class="line">set pagination off</span><br><span class="line">b my_malloc</span><br><span class="line">comm</span><br><span class="line">silent</span><br><span class="line">printf &quot;malloc 0x%x %lu\n&quot;, p, size</span><br><span class="line">bt</span><br><span class="line">c</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">b my_free</span><br><span class="line">comm</span><br><span class="line">silent</span><br><span class="line">printf &quot;free 0x%x\n&quot;, p</span><br><span class="line">bt</span><br><span class="line">c</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>直接让gdb执行它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gdb -q -p $(pidof $your_project) -x /tmp/malloc_free &gt; log</span><br></pre></td></tr></table></figure>

<p>运行一段时间后kill掉gdb，打开log看看里面的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ less log</span><br><span class="line">Attaching to process 8738</span><br><span class="line">Reading symbols from ...done.</span><br><span class="line">Reading symbols from /lib/x86_64-linux-gnu/libc.so.6...Reading symbols from /usr/</span><br><span class="line">lib/debug//lib/x86_64-linux-gnu/libc-2.19.so...done.</span><br><span class="line">done.</span><br><span class="line">Loaded symbols for /lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">......</span><br><span class="line">malloc 0x0 82</span><br><span class="line">#0  my_malloc (p=0x0, size=82) at memory.cpp:8</span><br><span class="line">#1  0x0000000000400657 in write_buffer (p=0x0, size=82) at memory.cpp:17</span><br><span class="line">#2  0x00000000004006b6 in main () at memory.cpp:25</span><br><span class="line">malloc 0x852c39c0 13</span><br><span class="line">#0  my_malloc (p=0x7ffd852c39c0 &quot;\001&quot;, size=13) at memory.cpp:8</span><br><span class="line">#1  0x0000000000400657 in write_buffer (p=0x7ffd852c39c0 &quot;\001&quot;, size=13) at memory.cpp:17</span><br><span class="line">#2  0x00000000004006b6 in main () at memory.cpp:25</span><br><span class="line">free 0x400780</span><br><span class="line">#0  my_free (p=0x400780 &lt;__libc_csu_init&gt; &quot;AWA\211\377AVI\211\366AUI\211\325ATL\215%x\006 &quot;) at memory.cpp:14</span><br><span class="line">#1  0x0000000000400632 in read_buffer (p=0x400780 &lt;__libc_csu_init&gt; &quot;AWA\211\377AVI\211\366AUI\211\325ATL\215%x\006 &quot;) at memory.cpp:16</span><br><span class="line">#2  0x00000000004006fe in main () at memory.cpp:28</span><br><span class="line">free 0x0</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>现在我们可以写个脚本对下帐。每次解析到<code>malloc</code>时，在对应指针的名下记下一项借出。解析到<code>free</code>时，表示销掉对应最近一次借出的还款。把全部输出解析完后，困扰已久的坏账情况就将水落石出，欠钱不还的老赖也将无可遁形。这种“拖网法”真的是简单粗暴又有效</p>
<p>我们还可以用这种“拖网法”获取指定函数的调用者比例、调用参数的分布范围等等。注意，不要在生产环境撒网，毕竟这么做对性能有显著影响。而且要做统计的话，也有更好的方法可以选</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>题目：reverse-box</p>
<p>来源：mma-ctf-2nd-2016</p>
<ul>
<li><h4 id="IDA分析代码"><a href="#IDA分析代码" class="headerlink" title="IDA分析代码"></a>IDA分析代码</h4></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2)</span> <span class="comment">//a2即为二维数组</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> i; <span class="comment">// [esp+18h] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-108h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+11Ch] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"usage: %s flag\n"</span>, *a2);<span class="comment">//a2[0]存输入的数据</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_804858D(&amp;v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a2[<span class="number">1</span>]); ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%02x"</span>, *((<span class="keyword">unsigned</span> __int8 *)&amp;v4 + a2[<span class="number">1</span>][i]));</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现关键功能函数<strong>sub_804858D</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_804858D</span><span class="params">(_BYTE *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// ST1B_1</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v7; <span class="comment">// [esp+1Ah] [ebp-Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+1Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+1Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v1 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v1);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    v10 = (<span class="keyword">unsigned</span> __int8)rand();</span><br><span class="line">  <span class="keyword">while</span> ( !v10 );</span><br><span class="line">  *a1 = v10;</span><br><span class="line">  v7 = <span class="number">1</span>;</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = v7 ^ <span class="number">2</span> * v7;</span><br><span class="line">    <span class="keyword">if</span> ( (v7 &amp; <span class="number">0x80</span>u) == <span class="number">0</span> )</span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = <span class="number">27</span>;</span><br><span class="line">    v7 = v2 ^ v3;</span><br><span class="line">    v4 = <span class="number">4</span> * (<span class="number">2</span> * v8 ^ v8) ^ <span class="number">2</span> * v8 ^ v8;</span><br><span class="line">    v9 = <span class="number">16</span> * v4 ^ v4;</span><br><span class="line">    <span class="keyword">if</span> ( v9 &gt;= <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">9</span>;</span><br><span class="line">    v8 = v9 ^ v5;</span><br><span class="line">    result = (<span class="keyword">unsigned</span> __int8)__ROR1__(v8, <span class="number">4</span>) ^ (<span class="keyword">unsigned</span> __int8)__ROR1__(v8, <span class="number">5</span>) ^ (<span class="keyword">unsigned</span> __int8)__ROR1__(v8, <span class="number">6</span>) ^ (<span class="keyword">unsigned</span> __int8)__ROR1__(v8, <span class="number">7</span>) ^ (<span class="keyword">unsigned</span> __int8)(v8 ^ *a1);</span><br><span class="line">    a1[v7] = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v7 != <span class="number">1</span> );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根绝srand、rand、time函数大概可以猜测即为生成一张随机数表，就可以使用GDB脚本爆出盒子</p>
<ul>
<li>注意看此函数的汇编代码，在取随机数种子的位置：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:080485A7                 call    _rand</span><br><span class="line">.text:080485AC                 and     eax, 0FFh</span><br><span class="line">.text:080485B1                 mov     [ebp+var_C], eax</span><br></pre></td></tr></table></figure>

<ul>
<li>程序的流程很简单，就是先以时间做种子，取随机数生成一张表，然后输入作为表的索引，输出对应表中的十六进制数据</li>
<li>题目给出的目标输出为：<strong>95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a</strong></li>
<li>实际上就是要求输入是多少</li>
</ul>
<p>下面是GDB脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> $i=<span class="number">0</span></span><br><span class="line"><span class="built_in">set</span> $total=<span class="number">256</span></span><br><span class="line"><span class="keyword">while</span>($i&lt;$total)</span><br><span class="line">　　b *<span class="number">0x080485B1</span>	#mov     [ebp+var_C], eax 即程序取随机函数后的地址 方便修改种子数</span><br><span class="line">　　b *<span class="number">0x8048704</span> #movzx   eax, al，即程序最终结果的地址</span><br><span class="line">　　run T	#开始跑程序</span><br><span class="line">　　<span class="built_in">set</span> $eax=$i #使得种子数等于爆破值i</span><br><span class="line">　　<span class="built_in">set</span> $i=$i+<span class="number">1</span> #i=i+<span class="number">1</span></span><br><span class="line">　　<span class="keyword">continue</span> #使得程序继续调试</span><br><span class="line">　　<span class="keyword">if</span> ($eax==<span class="number">0x95</span>) #当等于正确答案时打印表</span><br><span class="line">　　　　print $i, $i	#打印出正确的种子数</span><br><span class="line">　　　　x/<span class="number">256</span>xb $esp+<span class="number">0x1c</span> #打印盒子表</span><br><span class="line">　　　　<span class="built_in">set</span> $i=<span class="number">256</span>	#使得i=<span class="number">256</span>退出循环</span><br><span class="line">　　end</span><br><span class="line">　　stop</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>跑出来的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$1 = 215</span><br><span class="line">0xffffcf6c:	0xd6	0xc9	0xc2	0xce	0x47	0xde	0xda	0x70</span><br><span class="line">0xffffcf74:	0x85	0xb4	0xd2	0x9e	0x4b	0x62	0x1e	0xc3</span><br><span class="line">0xffffcf7c:	0x7f	0x37	0x7c	0xc8	0x4f	0xec	0xf2	0x45</span><br><span class="line">0xffffcf84:	0x18	0x61	0x17	0x1a	0x29	0x11	0xc7	0x75</span><br><span class="line">0xffffcf8c:	0x02	0x48	0x26	0x93	0x83	0x8a	0x42	0x79</span><br><span class="line">0xffffcf94:	0x81	0x10	0x50	0x44	0xc4	0x6d	0x84	0xa0</span><br><span class="line">0xffffcf9c:	0xb1	0x72	0x96	0x76	0xad	0x23	0xb0	0x2f</span><br><span class="line">0xffffcfa4:	0xb2	0xa7	0x35	0x57	0x5e	0x92	0x07	0xc0</span><br><span class="line">0xffffcfac:	0xbc	0x36	0x99	0xaf	0xae	0xdb	0xef	0x15</span><br><span class="line">0xffffcfb4:	0xe7	0x8e	0x63	0x06	0x9c	0x56	0x9a	0x31</span><br><span class="line">0xffffcfbc:	0xe6	0x64	0xb5	0x58	0x95	0x49	0x04	0xee</span><br><span class="line">0xffffcfc4:	0xdf	0x7e	0x0b	0x8c	0xff	0xf9	0xed	0x7a</span><br><span class="line">0xffffcfcc:	0x65	0x5a	0x1f	0x4e	0xf6	0xf8	0x86	0x30</span><br><span class="line">0xffffcfd4:	0xf0	0x4c	0xb7	0xca	0xe5	0x89	0x2a	0x1d</span><br><span class="line">0xffffcfdc:	0xe4	0x16	0xf5	0x3a	0x27	0x28	0x8d	0x40</span><br><span class="line">0xffffcfe4:	0x09	0x03	0x6f	0x94	0xa5	0x4a	0x46	0x67</span><br><span class="line">0xffffcfec:	0x78	0xb9	0xa6	0x59	0xea	0x22	0xf1	0xa2</span><br><span class="line">0xffffcff4:	0x71	0x12	0xcb	0x88	0xd1	0xe8	0xac	0xc6</span><br><span class="line">0xffffcffc:	0xd5	0x34	0xfa	0x69	0x97	0x9f	0x25	0x3d</span><br><span class="line">0xffffd004:	0xf3	0x5b	0x0d	0xa1	0x6b	0xeb	0xbe	0x6e</span><br><span class="line">0xffffd00c:	0x55	0x87	0x8f	0xbf	0xfc	0xb3	0x91	0xe9</span><br><span class="line">0xffffd014:	0x77	0x66	0x19	0xd7	0x24	0x20	0x51	0xcc</span><br><span class="line">0xffffd01c:	0x52	0x7d	0x82	0xd8	0x38	0x60	0xfb	0x1c</span><br><span class="line">0xffffd024:	0xd9	0xe3	0x41	0x5f	0xd0	0xcf	0x1b	0xbd</span><br><span class="line">0xffffd02c:	0x0f	0xcd	0x90	0x9b	0xa9	0x13	0x01	0x73</span><br><span class="line">0xffffd034:	0x5d	0x68	0xc1	0xaa	0xfe	0x08	0x3e	0x3f</span><br><span class="line">0xffffd03c:	0xc5	0x8b	0x00	0xd3	0xfd	0xb6	0x43	0xbb</span><br><span class="line">0xffffd044:	0xd4	0x80	0xe2	0x0c	0x33	0x74	0xa8	0x2b</span><br><span class="line">0xffffd04c:	0x54	0x4d	0x2d	0xa4	0xdc	0x6c	0x3b	0x21</span><br><span class="line">0xffffd054:	0x2e	0xab	0x32	0x5c	0x7b	0xe0	0x9d	0x6a</span><br><span class="line">0xffffd05c:	0x39	0x14	0x3c	0xb8	0x0a	0x53	0xf7	0xdd</span><br><span class="line">0xffffd064:	0xf4	0x2c	0x98	0xba	0x05	0xe1	0x0e	0xa3</span><br></pre></td></tr></table></figure>

<p>最后的解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">correct=<span class="string">'95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a'</span></span><br><span class="line">box=[\</span><br><span class="line"><span class="number">0xd6</span>,<span class="number">0xc9</span>,<span class="number">0xc2</span>,<span class="number">0xce</span>,<span class="number">0x47</span>,<span class="number">0xde</span>,<span class="number">0xda</span>,<span class="number">0x70</span>,\</span><br><span class="line"><span class="number">0x85</span>,<span class="number">0xb4</span>,<span class="number">0xd2</span>,<span class="number">0x9e</span>,<span class="number">0x4b</span>,<span class="number">0x62</span>,<span class="number">0x1e</span>,<span class="number">0xc3</span>,\</span><br><span class="line"><span class="number">0x7f</span>,<span class="number">0x37</span>,<span class="number">0x7c</span>,<span class="number">0xc8</span>,<span class="number">0x4f</span>,<span class="number">0xec</span>,<span class="number">0xf2</span>,<span class="number">0x45</span>,\</span><br><span class="line"><span class="number">0x18</span>,<span class="number">0x61</span>,<span class="number">0x17</span>,<span class="number">0x1a</span>,<span class="number">0x29</span>,<span class="number">0x11</span>,<span class="number">0xc7</span>,<span class="number">0x75</span>,\</span><br><span class="line"><span class="number">0x02</span>,<span class="number">0x48</span>,<span class="number">0x26</span>,<span class="number">0x93</span>,<span class="number">0x83</span>,<span class="number">0x8a</span>,<span class="number">0x42</span>,<span class="number">0x79</span>,\</span><br><span class="line"><span class="number">0x81</span>,<span class="number">0x10</span>,<span class="number">0x50</span>,<span class="number">0x44</span>,<span class="number">0xc4</span>,<span class="number">0x6d</span>,<span class="number">0x84</span>,<span class="number">0xa0</span>,\</span><br><span class="line"><span class="number">0xb1</span>,<span class="number">0x72</span>,<span class="number">0x96</span>,<span class="number">0x76</span>,<span class="number">0xad</span>,<span class="number">0x23</span>,<span class="number">0xb0</span>,<span class="number">0x2f</span>,\</span><br><span class="line"><span class="number">0xb2</span>,<span class="number">0xa7</span>,<span class="number">0x35</span>,<span class="number">0x57</span>,<span class="number">0x5e</span>,<span class="number">0x92</span>,<span class="number">0x07</span>,<span class="number">0xc0</span>,\</span><br><span class="line"><span class="number">0xbc</span>,<span class="number">0x36</span>,<span class="number">0x99</span>,<span class="number">0xaf</span>,<span class="number">0xae</span>,<span class="number">0xdb</span>,<span class="number">0xef</span>,<span class="number">0x15</span>,\</span><br><span class="line"><span class="number">0xe7</span>,<span class="number">0x8e</span>,<span class="number">0x63</span>,<span class="number">0x06</span>,<span class="number">0x9c</span>,<span class="number">0x56</span>,<span class="number">0x9a</span>,<span class="number">0x31</span>,\</span><br><span class="line"><span class="number">0xe6</span>,<span class="number">0x64</span>,<span class="number">0xb5</span>,<span class="number">0x58</span>,<span class="number">0x95</span>,<span class="number">0x49</span>,<span class="number">0x04</span>,<span class="number">0xee</span>,\</span><br><span class="line"><span class="number">0xdf</span>,<span class="number">0x7e</span>,<span class="number">0x0b</span>,<span class="number">0x8c</span>,<span class="number">0xff</span>,<span class="number">0xf9</span>,<span class="number">0xed</span>,<span class="number">0x7a</span>,\</span><br><span class="line"><span class="number">0x65</span>,<span class="number">0x5a</span>,<span class="number">0x1f</span>,<span class="number">0x4e</span>,<span class="number">0xf6</span>,<span class="number">0xf8</span>,<span class="number">0x86</span>,<span class="number">0x30</span>,\</span><br><span class="line"><span class="number">0xf0</span>,<span class="number">0x4c</span>,<span class="number">0xb7</span>,<span class="number">0xca</span>,<span class="number">0xe5</span>,<span class="number">0x89</span>,<span class="number">0x2a</span>,<span class="number">0x1d</span>,\</span><br><span class="line"><span class="number">0xe4</span>,<span class="number">0x16</span>,<span class="number">0xf5</span>,<span class="number">0x3a</span>,<span class="number">0x27</span>,<span class="number">0x28</span>,<span class="number">0x8d</span>,<span class="number">0x40</span>,\</span><br><span class="line"><span class="number">0x09</span>,<span class="number">0x03</span>,<span class="number">0x6f</span>,<span class="number">0x94</span>,<span class="number">0xa5</span>,<span class="number">0x4a</span>,<span class="number">0x46</span>,<span class="number">0x67</span>,\</span><br><span class="line"><span class="number">0x78</span>,<span class="number">0xb9</span>,<span class="number">0xa6</span>,<span class="number">0x59</span>,<span class="number">0xea</span>,<span class="number">0x22</span>,<span class="number">0xf1</span>,<span class="number">0xa2</span>,\</span><br><span class="line"><span class="number">0x71</span>,<span class="number">0x12</span>,<span class="number">0xcb</span>,<span class="number">0x88</span>,<span class="number">0xd1</span>,<span class="number">0xe8</span>,<span class="number">0xac</span>,<span class="number">0xc6</span>,\</span><br><span class="line"><span class="number">0xd5</span>,<span class="number">0x34</span>,<span class="number">0xfa</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x9f</span>,<span class="number">0x25</span>,<span class="number">0x3d</span>,\</span><br><span class="line"><span class="number">0xf3</span>,<span class="number">0x5b</span>,<span class="number">0x0d</span>,<span class="number">0xa1</span>,<span class="number">0x6b</span>,<span class="number">0xeb</span>,<span class="number">0xbe</span>,<span class="number">0x6e</span>,\</span><br><span class="line"><span class="number">0x55</span>,<span class="number">0x87</span>,<span class="number">0x8f</span>,<span class="number">0xbf</span>,<span class="number">0xfc</span>,<span class="number">0xb3</span>,<span class="number">0x91</span>,<span class="number">0xe9</span>,\</span><br><span class="line"><span class="number">0x77</span>,<span class="number">0x66</span>,<span class="number">0x19</span>,<span class="number">0xd7</span>,<span class="number">0x24</span>,<span class="number">0x20</span>,<span class="number">0x51</span>,<span class="number">0xcc</span>,\</span><br><span class="line"><span class="number">0x52</span>,<span class="number">0x7d</span>,<span class="number">0x82</span>,<span class="number">0xd8</span>,<span class="number">0x38</span>,<span class="number">0x60</span>,<span class="number">0xfb</span>,<span class="number">0x1c</span>,\</span><br><span class="line"><span class="number">0xd9</span>,<span class="number">0xe3</span>,<span class="number">0x41</span>,<span class="number">0x5f</span>,<span class="number">0xd0</span>,<span class="number">0xcf</span>,<span class="number">0x1b</span>,<span class="number">0xbd</span>,\</span><br><span class="line"><span class="number">0x0f</span>,<span class="number">0xcd</span>,<span class="number">0x90</span>,<span class="number">0x9b</span>,<span class="number">0xa9</span>,<span class="number">0x13</span>,<span class="number">0x01</span>,<span class="number">0x73</span>,\</span><br><span class="line"><span class="number">0x5d</span>,<span class="number">0x68</span>,<span class="number">0xc1</span>,<span class="number">0xaa</span>,<span class="number">0xfe</span>,<span class="number">0x08</span>,<span class="number">0x3e</span>,<span class="number">0x3f</span>,\</span><br><span class="line"><span class="number">0xc5</span>,<span class="number">0x8b</span>,<span class="number">0x00</span>,<span class="number">0xd3</span>,<span class="number">0xfd</span>,<span class="number">0xb6</span>,<span class="number">0x43</span>,<span class="number">0xbb</span>,\</span><br><span class="line"><span class="number">0xd4</span>,<span class="number">0x80</span>,<span class="number">0xe2</span>,<span class="number">0x0c</span>,<span class="number">0x33</span>,<span class="number">0x74</span>,<span class="number">0xa8</span>,<span class="number">0x2b</span>,\</span><br><span class="line"><span class="number">0x54</span>,<span class="number">0x4d</span>,<span class="number">0x2d</span>,<span class="number">0xa4</span>,<span class="number">0xdc</span>,<span class="number">0x6c</span>,<span class="number">0x3b</span>,<span class="number">0x21</span>,\</span><br><span class="line"><span class="number">0x2e</span>,<span class="number">0xab</span>,<span class="number">0x32</span>,<span class="number">0x5c</span>,<span class="number">0x7b</span>,<span class="number">0xe0</span>,<span class="number">0x9d</span>,<span class="number">0x6a</span>,\</span><br><span class="line"><span class="number">0x39</span>,<span class="number">0x14</span>,<span class="number">0x3c</span>,<span class="number">0xb8</span>,<span class="number">0x0a</span>,<span class="number">0x53</span>,<span class="number">0xf7</span>,<span class="number">0xdd</span>,\</span><br><span class="line"><span class="number">0xf4</span>,<span class="number">0x2c</span>,<span class="number">0x98</span>,<span class="number">0xba</span>,<span class="number">0x05</span>,<span class="number">0xe1</span>,<span class="number">0x0e</span>,<span class="number">0xa3</span>\</span><br><span class="line">]</span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(correct)//<span class="number">2</span>):</span><br><span class="line">    idx=box.index(int(correct[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">    flag+=chr(idx)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>【1】<a href="https://segmentfault.com/a/1190000005367875" target="_blank" rel="noopener">GDB 自动化操作的技术</a></p>
<p>【2】<a href="https://segmentfault.com/a/1190000005718889" target="_blank" rel="noopener">用 Python 拓展 GDB（一）</a></p>
<p>【3】<a href="https://nettee.github.io/posts/2018/GDB-automated-debugging/" target="_blank" rel="noopener">GDB 自动化调试</a></p>
<p>【4】<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/" target="_blank" rel="noopener">GDB User Manual</a></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/11/23/╧Ω╜ΓUnLink/" rel="next" title="详解UnLink">
                  <i class="fa fa-chevron-left"></i> 详解UnLink
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/12/10/IDA╜┼▒╛▒╩╝╟╥╗/" rel="prev" title="IDA脚本笔记一">
                  IDA脚本笔记一 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Inhaltsverzeichnis
        </li>
        <li class="sidebar-nav-overview">
          Übersicht
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#引子"><span class="nav-number">1.</span> <span class="nav-text">引子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#commands"><span class="nav-number">2.</span> <span class="nav-text">commands</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#define"><span class="nav-number">3.</span> <span class="nav-text">define</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#document"><span class="nav-number">4.</span> <span class="nav-text">document</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#会话-历史-命令文件"><span class="nav-number">5.</span> <span class="nav-text">会话/历史/命令文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调试脚本"><span class="nav-number">6.</span> <span class="nav-text">调试脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实战"><span class="nav-number">7.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IDA分析代码"><span class="nav-number">7.0.1.</span> <span class="nav-text">IDA分析代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">8.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZERO-A-ONE</p>
  <div class="site-description" itemprop="description">Resit much,Obey little</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">Artikel</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">Kategorien</span>
        
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZERO-A-ONE</span>
</div>
  <div class="powered-by">Erstellt mit  <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Design – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.0</div>

<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" style='display:none'>
    本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    <span class="post-meta-divider">|</span>
</span>
<span id="busuanzi_container_site_uv" style='display:none'>
    有<span id="busuanzi_value_site_uv"></span>人看过我的博客啦
</span>
</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

</body>
</html>
